<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Soft gripper redundancy system</title>
    <style>
        table, th, td {
          border: 1px solid black;
        }

        .container {
            display: inline-block;
            width: 820px;
            margin: 15px;
        }
    </style>
</head>
<body onload="update_values()">
    <div class="container">
        <h2>Camera data</h2>
        <img id="bg" src="{{ url_for('video_feed') }}">
    </div>
    <div class="container">
        <h2>Sensor data</h2>
        <table style="width:800px;">
          <tr>
            <th colspan="3">FR</th>
            <th colspan="3">FL</th>
          </tr>
          <tr>
            <td id='fr1'></td>
            <td id='fr2'></td>
            <td id='fr3'></td>
            <td id='fl1'></td>
            <td id='fl2'></td>
            <td id='fl3'></td>
          </tr>
        </table>
        <div class="chart" id="dataPlots" style="width:800px;height:600px;">
            <canvas id="plot"></canvas>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script type="text/javascript">
        let intervalID = setInterval(update_values, 1000);
        let c = 0;
        let handleTemp = [0,0,0,0,0,0];
        let timeArray = [0];

        let data = {
          labels: timeArray,
          datasets: [{
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            borderColor: 'rgba(255, 99, 132, 1)',
            data: [handleTemp[0]],
            label: 'FR1',
            borderWidth: 1
          }, {
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 0.2)',
            data: [handleTemp[1]],
            label: 'FR2',
            borderWidth: 1
          }, {
            backgroundColor: 'rgba(255, 206, 86, 0.2)',
            borderColor: 'rgba(255, 206, 86, 0.2)',
            data: [handleTemp[2]],
            label: 'FR3',
            borderWidth: 1
          }, {
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 0.2)',
            data: [handleTemp[3]],
            label: 'FL1',
            borderWidth: 1
          }, {
            backgroundColor: 'rgba(153, 102, 255, 0.2)',
            borderColor: 'rgba(153, 102, 255, 0.2)',
            data: [handleTemp[4]],
            label: 'FL2',
            borderWidth: 1
          }, {
            backgroundColor: 'rgba(255, 159, 64, 0.2)',
            borderColor: 'rgba(255, 159, 64, 0.2)',
            data: [handleTemp[5]],
            label: 'FL3',
            borderWidth: 1
          }]
        };
        const ctx = document.getElementById('plot');
        const config = {
          type: 'line',
          data: data,
          options: {
            scales: {
              yAxes: [{
                ticks: {
                  beginAtZero: true
                }
              }]
            }
          }
        }
        let chart = new Chart(ctx, config);

        function update_values() {
          $.get("/sensor_data",
              (data) => {
                handleTemp[0] = data[0];
                handleTemp[1] = data[1];
                handleTemp[2] = data[2];
                handleTemp[3] = data[3];
                handleTemp[4] = data[4];
                handleTemp[5] = data[5];
                $('#fr1').text(handleTemp[0])
                $('#fr2').text(handleTemp[1])
                $('#fr3').text(handleTemp[2])
                $('#fl1').text(handleTemp[3])
                $('#fl2').text(handleTemp[4])
                $('#fl3').text(handleTemp[5])
          });

          c += 1;
          timeArray.push(c);
          //console.log(c);
          //console.log(handleTemp);

          let i = 0;
          chart.data.datasets.forEach((dataset) => {
              dataset.data.push(handleTemp[i]);
              i += 1;
          });
          if (c > 30) {
            chart.data.labels.pop();
            chart.data.datasets.forEach((dataset) => {
                dataset.data.shift();
            });
          }
          chart.update();
        }
    </script>
</body>
</html>